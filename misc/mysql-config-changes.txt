# performance tuning stuff
# https://www.percona.com/blog/2007/11/01/innodb-performance-optimization-basics/

sudo vi /etc/mysql/mysql.conf.d/mysqld.cnf 

	innodb_buffer_pool_size = 10G
	innodb_log_file_size = 1G
	innodb_log_buffer_size = 128M
	innodb_flush_log_at_trx_commit = 2
	innodb_flush_method = O_DIRECT
	innodb_autoinc_lock_mode = 2

	max_allowed_packet = 256M

	group_concat_max_len = 1048576

	datadir = /media/jbod/mysql-data
	tmpdir = /media/jbod/mysql-tmp

	query_cache_type = 1
	query_cache_size = 128M
	
	wait_timeout = 86400
	interactive_timeout = 86400
	
	connect_timeout = 60

	open_files_limit = 102400

	[mysqld_safe]
	open_files_limit = 102400

# fix max file limit issue
sudo vi /etc/security/limits.conf

	mysql hard nofile 1024000
	mysql soft nofile 1024000

sudo vi /etc/pam.d/common-session
sudo vi /etc/pam.d/common-session-noninteractive
	
	session required        pam_limits.so

# fix user home issue
sudo usermod -d /var/lib/mysql/ mysql

# edit the apparmor settings
sudo vi /etc/apparmor.d/usr.sbin.mysqld

  /media/jbod/mysql-data/ r,  
  /media/jbod/mysql-data/** rw,

  /media/jbod/mysql-tmp/ r,  
  /media/jbod/mysql-tmp/** rw,

# restart everything
sudo service apparmor restart
sudo service mysql restart
